---
title: Go 语言概述
date created: 星期四, 二月 2日 2023, 2:45:39 下午
date modified: 星期四, 二月 2日 2023, 2:54:19 下午
---

# Go 语言概述

## 1、为什么需要 Go 语言

相比 C++ 和 java, Go 语言更年轻，他存在的意义何在呢？  
1. 在计算领域，是 C/C++ 的天下，因为执行效率高，但缺点是开发和编译效率低。  
2. 对于 Java，虽然编译速度快、开发效率高，但执行效率不如 C/C++。  
3. 而动态语言如 Python，由于没有强类型约束，很多问题需要在运行时发现：这种低级错误由编译器来发现更好些。  

>[!tip] 综上，期待出现一种语言来解决上述语言的缺点，Go 语言这时出现，它易于开发、快速编译、高效执行

Go 语言起源于 2007 年，由 google 2009 年发布。  
Go 编译后的代码，运行速度可媲美 C/C++，且编译速度更快，因此风靡全球，被称为 21 世纪的 C 语言（Go 不仅具备 C 的性能与安全，且提供了 21 世纪互联网环境下服务端开发的各种使用特性）  
Go 语言的设计哲学是：==简单==、==实用==。

Go 语言是对类 C 语言的重大改进，它可以访问底层操作系统，还提供了强大的 [网络编程](https://so.csdn.net/so/search?q=%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B&spm=1001.2101.3001.7020) 和并发编程的支持。Go 语言可进行网络编程、系统编程、并发编程、分布式编程。

1. 并发场景性能快  
2. 静态的语言：没有面向对象中的“类”  
3. 支持自动垃圾回收  
4. 编译型语言：编译速度快

**Go 遵循简洁编程原则：**  

1. 它没有隐式的数值转换  
2. 没有构造函数和析构函数  
3. 没有运算符重载  
4. 没有默认参数  
5. 也没有继承  
6. 没有泛型  
7. 没有异常  
8. 没有宏  
9. 没有函数修饰  
10. 更没有线程局部存储

>[! Tip] Go 承诺保证向后兼容
>用之前的 Go 语言编写程序可以用新版本的 Go 语言编译器和标准库直接构建而不需要修改代码

Go 语言支持 [交叉编译](https://so.csdn.net/so/search?q=%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91&spm=1001.2101.3001.7020)，即可以在 Linux 系统上开发基于 Windows 上运行的程序，因为这是一门完全支持 UTF-8 的语言，不仅体现在他可以处理使用 UTF-8 编码的字符串，就连他的源码稳居格式都是使用 UTF-8 编码。

## 2.Go 是编译型语言

Go 代码在运行前，需要使用编译器来编译代码，编译器将源代码编译成二进制（或字节码）格式；在编译代码时，编译器会做错误检查、性能优化，然后输出可在不同平台上运行的二进制文件。

要运行 Go 程序，需要的步骤：
1. 使用文本编辑器写 Go 代码 
2. 编译程序 
3. 运行编译后得到的可执行文件。

这与 Python, Javascript 等语言不同，Go 自带了编译器。

## 3.Go 语言的特性

### 1、语法简单

Go 语法与 C 类似，但没有 C 那些隐秘晦涩的规则，Go 语法简单严谨，无歧义。

### 2.并发模型

Go 引入了携程 Goroutine，从根本上将一切都并发化，运行时用 goroutine 运行所有的一切，包括 main. main 入口函数。

Goroutine 用类携程的方式来处理并发单元，却又在运行时层面做了更深度的优化处理。但语法上的 [并发编程](https://so.csdn.net/so/search?q=%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B&spm=1001.2101.3001.7020) 变得极为简单，无需处理回调，无需关注现场切换。

goroutine 搭配 channel，实现 CSP 模型。将并发单元间的数据耦合拆解开来，各司其职。这样对所有纠结于内存共享、锁粒度的程序员都是一种解脱。

### 3.内存分配

将一起并发化虽然好，但也带来了新问题，即如何实现高并发下内存的分配和管理。Go 选择了 tcmalloc，他本就是为了并发儿设计的高性能内存分配组件。

去除因配合垃圾回收而修改的内容，内存分配器完整保留了 tcmailoc 的原始架构。使用 cache 为当前线程提供无锁分配，多个 central 在不同线程间平衡内存单元复用。在更高层次里，heap 管理大块内存分配，用以切分成不同等级的复用内存块。快速分配和二级平衡机制，让内存分配器能优秀地完成高压力下的内存管理任务。

除了偶尔因性能问题而被迫采用对象池和自主内存管理外，我们基本无需参与内存管理操作。

### 4、垃圾回收

相比 Java, Go 的垃圾回收面临的困难更多，因为指针的存在。幸好，指针运算被阻止，否则要做到精确回收都难。  
每次版本升级，垃圾回收期都是核心组件里修改最多的部分，从并发清理，到降低 STW 的时间，直到 Go 的 1.5 版本实现并发标记，逐步引入三色标记和写屏障等，都是为了能让垃圾回收在不影响用户逻辑的情况下更好地工作。但当前最新版本的垃圾回收算法也只能说堪用，距离好用还有不少距离。

### 5.静态链接

静态链接，只需编译后的一个可执行文件（将运行时、依赖库直接打包到可执行文件内部），无需附加任何东西，就能部署。这种简单的方式对于编写系统软件有极大好处，无需实现安装运行环境和下载各种第三方库。

### 6.标准库

Go 的标准库算比较丰富，其中值得称道的事 net/http，仅需要简单的几条语句，就能实现一个高性能的 web server，大批基于此的优秀第三方 Framework 更将 Go 推到了 Web/微服务开发标准之一的位置。

### 7.工具链

完整的工具链对日常开发极有帮助，Go 的工具链做的不错，无论是编译、格式化、错误检查、帮助文档，还是第三方包的下载、更新，都有对应的工具。虽然这些工具算不上多完善，但简单易用。

Go 内置的测试框架，其中包括单元测试、性能测试、代码覆盖率、数据竞争，及用来调优的 pprof，都是包子代码正确与稳定运行的必备利器。

此外，还可通过环境变量输出运行时的监控信息，尤其是垃圾回收和并发调度跟踪，可进一步帮助我们改善算法，获得最佳的运行期表现。

## 4.Go 语言为并发而生

Go 语言的祖先 C 语言的指令都是串行执行，即同一时刻仅有一个指令在使用 CPU。  
随着多核处理器的发展，一些语言框架（如 Java Netty）也在致力于提高多核 CPU 使用效率，但仍需要开发人员花精力去搞懂这些框架的原理及使用方法。

Go 语言是在多核和网络化时代诞生的语言，天生就从底层支持并发，无需第三方库，程序员可以在写程序时很轻松地指定怎样使用 CPU 资源。

Go 的并发，基于 goroutine，可以将 goroutine 理解为一种虚拟线程。Go 语言运行时会参与调度 goroutine，并将 goroutine 合理地分配到每个 CPU 中，最大限度地使用 CPU 性能。

多个 goroutine 之间，通过使用 channel 通信，channel 是一种内置的数据结构，可以让用户在不同的 goroutine 之间同步发送具有类型的消息。这种编程模型更倾向于在 goroutine 之间发送消息，而不是让多个 goroutine 争夺同一个数据的使用权。

程序可以把并发 goroutine 间的通信设计为生产者/消费者模式，将要通信的数据放入 channel，然后 channel 另一端的代码将这些数据并发消费。

【goroutine 与 channel 的例子】：生产者每秒生成一个字符串，并放入 channel，生产者使用两个 goroutine 并发写入 channel，消费者在 main () 函数的 goroutine 中处理。

```go
package main
import (
        "fmt"
        "math/rand"
        "time"
)
// 数据生产者
func producer(header string, channel chan<- string) {
     // 无限循环, 不停地生产数据
     for {
         // 将随机数和字符串格式化为字符串发送给通道
         channel <- fmt.Sprintf("%s: %v", header, rand.Int31())
         // 等待1秒
         time.Sleep(time.Second)
     }
}
// 数据消费者
func customer(channel <-chan string) {
     // 不停地获取数据
     for {
         // 从通道中取出数据, 此处会阻塞直到信道中返回数据
         message := <-channel
         // 打印数据
         fmt.Println(message)
     }
}
func main() {
    // 创建一个字符串类型的通道
    channel := make(chan string)
    // 创建producer()函数的并发goroutine
    go producer("cat", channel)
    go producer("dog", channel)
    // 数据消费函数
    customer(channel)
}
```

运行结果：

```shell
dog: 2019727887
cat: 1298498081
dog: 939984059
cat: 1427131847
cat: 911902081
dog: 1474941318
dog: 140954425
cat: 336122540
cat: 208240456
dog: 646203300
```

可以看到，在并发的生产者、消费者过程中，程序员无需创建线程，无需线程池，也无需加锁，仅通过 goroutine 和 channel，即可实现并发的目的。

## 5.各语言性能测试

表中数据的单位为秒，数值越小表明运行性能越好：  
![在这里插入图片描述](https://img-blog.csdnimg.cn/482428bdeeb64b76a1ac79006202a011.png)  
从上表可以看出，go 语言的性能接近于 java, 不如 C/C++。

## 6.Go 语言的标准库

学习编程语言，重点不单是学语法，而是熟悉其生态圈，标准库是生态圈中的重要一环。  
Go 语言的标准库，提供了构建模块和公共接口，包括 I/O 操作、文本处理、图像、密码学、网络和分布式应用程序等，并支持许多标准化的文件格式和编解码协议。

Go 语言的编译器也是标准库中的一部分，他通过词法器扫描源码，使用语法树获得源码的逻辑分支等。  
Go 语言的周边工具，都是建立在标准库上，用标准库可以完成绝大部分需求。

Go 语言常见的包及功能如下表：  
![在这里插入图片描述](https://img-blog.csdnimg.cn/6ec481a565e74074886c7308c2b26d45.png)