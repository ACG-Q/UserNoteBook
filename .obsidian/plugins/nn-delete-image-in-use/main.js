/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => NathanDeleteImage
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// src/settings.ts
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  deleteOption: ".trash"
};
var NathanDeleteImageSettingsTab = class extends import_obsidian.PluginSettingTab {
  constructor(app2, plugin) {
    super(app2, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Delete Image In Use Settings" });
    new import_obsidian.Setting(containerEl).setName("Deleted Image Destination").setDesc("Select where you want images to be moved once they are deleted").addDropdown((dropdown) => {
      dropdown.addOption("permanent", "Delete Permanently");
      dropdown.addOption(".trash", "Move to Obsidian Trash");
      dropdown.addOption("system-trash", "Move to System Trash");
      dropdown.setValue(this.plugin.settings.deleteOption);
      dropdown.onChange((option) => {
        this.plugin.settings.deleteOption = option;
        this.plugin.saveSettings();
      });
    });
  }
};

// src/main.ts
var imageExtensions = /* @__PURE__ */ new Set([
  "jpeg",
  "jpg",
  "png",
  "gif",
  "svg",
  "bmp"
]);
var SUCCESS_NOTICE_TIMEOUT = 1800;
var NathanDeleteImage = class extends import_obsidian2.Plugin {
  constructor() {
    super(...arguments);
    this.getAllImageFilesList = () => {
      const allFiles = app.vault.getFiles();
      const attachments = [];
      for (let i = 0; i < allFiles.length; i++) {
        if (allFiles[i].extension !== "md") {
          if (imageExtensions.has(allFiles[i].extension.toLowerCase())) {
            attachments.push(allFiles[i]);
          }
        }
      }
      return attachments;
    };
    this.getFileViaFullURLOfImage = (imageURL) => {
      let imageFileFullPath;
      const fileList = [];
      const allImageFiles = this.getAllImageFilesList();
      allImageFiles.forEach((imageFile) => {
        imageFileFullPath = app.vault.getResourcePath(imageFile);
        if (imageURL === imageFileFullPath) {
          fileList.push(imageFile);
        }
      });
      return fileList;
    };
  }
  async onload() {
    console.log("Delete Image In Use plugin loaded...");
    this.addSettingTab(new NathanDeleteImageSettingsTab(this.app, this));
    await this.loadSettings();
    this.registerDocument(document);
    app.workspace.on("window-open", (workspaceWindow, window2) => {
      this.registerDocument(window2.document);
    });
    this.registerInterval(window.setInterval(() => console.log("setInterval"), 5 * 60 * 1e3));
  }
  onunload() {
    console.log("Delete Image In Use plugin unloaded...");
  }
  onElement(el, event, selector, listener, options) {
    el.on(event, selector, listener, options);
    return () => el.off(event, selector, listener, options);
  }
  registerDocument(document2) {
    this.register(this.onElement(document2, "contextmenu", "img", this.onClick.bind(this)));
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  registerEscapeButton(menu, document2 = activeDocument) {
    menu.register(this.onElement(document2, "keydown", "*", (e) => {
      if (e.key === "Escape") {
        e.preventDefault();
        e.stopPropagation();
        menu.hide();
      }
    }));
  }
  onClick(event) {
    event.preventDefault();
    const target = event.target;
    const imgType = target.localName;
    const menu = new import_obsidian2.Menu();
    const deleteOption = this.settings.deleteOption;
    let fileList;
    switch (imgType) {
      case "img": {
        const image = target.currentSrc;
        const imageDom = target;
        const thisURL = new URL(image);
        fileList = this.getFileViaFullURLOfImage(image);
        const Proto = thisURL.protocol;
        switch (Proto) {
          case "app:":
          case "data:":
          case "http:":
          case "https:":
            menu.addItem((item) => item.setIcon("trash").setTitle("Delete Image In Use url and file").onClick(async () => {
              var _a;
              try {
                for (const file of fileList) {
                  const parent_div = (_a = imageDom.parentElement) == null ? void 0 : _a.parentElement;
                  const parentOfimge = imageDom.parentElement;
                  parent_div.removeChild(parentOfimge);
                  console.log("\u{1F6A9}--------parent_dic attributename--------:" + parent_div.getAttributeNames);
                  if (deleteOption === ".trash") {
                    await app.vault.trash(file, false);
                    console.log("--\u56FE\u7247--" + thisURL + "\u88AB\u5220\u9664\u4E86");
                    new import_obsidian2.Notice("Image moved to Obsidian Trash !", SUCCESS_NOTICE_TIMEOUT);
                  } else if (deleteOption === "system-trash") {
                    await app.vault.trash(file, true);
                    console.log("--\u56FE\u7247--" + thisURL + "\u88AB\u5220\u9664\u4E86");
                    new import_obsidian2.Notice("Image moved to System Trash !", SUCCESS_NOTICE_TIMEOUT);
                  } else if (deleteOption === "permanent") {
                    await app.vault.delete(file);
                    console.log("--\u56FE\u7247--" + thisURL + "\u88AB\u5220\u9664\u4E86");
                    new import_obsidian2.Notice("Image deleted Permanently !", SUCCESS_NOTICE_TIMEOUT);
                  }
                }
              } catch (e) {
                new import_obsidian2.Notice("Error, could not deleye the image!");
              }
            }));
            break;
          default:
            new import_obsidian2.Notice(`no handler for ${Proto} protocol`);
            return;
        }
        break;
      }
      default:
        new import_obsidian2.Notice("No handler for this image type!");
        return;
    }
    this.registerEscapeButton(menu);
    menu.showAtPosition({ x: event.pageX, y: event.pageY });
    this.app.workspace.trigger("nn-delete-image-in-use:contextmenu", menu);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBNZW51LCBNZW51SXRlbSwgVEZpbGUsIE5vdGljZSwgUGx1Z2luIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcbmltcG9ydCB7IE5hdGhhbkRlbGV0ZUltYWdlU2V0dGluZ3NUYWIgfSBmcm9tIFwiLi9zZXR0aW5nc1wiO1xyXG5pbXBvcnQgeyBOYXRoYW5EZWxldGVJbWFnZVNldHRpbmdzLCBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcclxuXHJcbmNvbnN0IGltYWdlRXh0ZW5zaW9uczogU2V0PHN0cmluZz4gPSBuZXcgU2V0KFtcclxuXHRcImpwZWdcIixcclxuXHRcImpwZ1wiLFxyXG5cdFwicG5nXCIsXHJcblx0XCJnaWZcIixcclxuXHRcInN2Z1wiLFxyXG5cdFwiYm1wXCIsXHJcbl0pO1xyXG5jb25zdCBTVUNDRVNTX05PVElDRV9USU1FT1VUID0gMTgwMDtcclxuXHJcbmludGVyZmFjZSBMaXN0ZW5lciB7XHJcblx0KHRoaXM6IERvY3VtZW50LCBldjogRXZlbnQpOiBhbnk7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE5hdGhhbkRlbGV0ZUltYWdlIGV4dGVuZHMgUGx1Z2luIHtcclxuXHRzZXR0aW5nczogTmF0aGFuRGVsZXRlSW1hZ2VTZXR0aW5ncztcclxuXHRhc3luYyBvbmxvYWQoKSB7XHJcblx0XHRjb25zb2xlLmxvZyhcIkRlbGV0ZSBJbWFnZSBJbiBVc2UgcGx1Z2luIGxvYWRlZC4uLlwiKTtcclxuXHRcdHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgTmF0aGFuRGVsZXRlSW1hZ2VTZXR0aW5nc1RhYih0aGlzLmFwcCwgdGhpcykpO1xyXG5cdFx0YXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcclxuXHRcdHRoaXMucmVnaXN0ZXJEb2N1bWVudChkb2N1bWVudCk7IC8vIFx1OEMwM1x1NzUyOFx1NkNFOFx1NTE4Q1x1NjU4N1x1Njg2M1x1NjVCOVx1NkNENVxyXG5cdFx0YXBwLndvcmtzcGFjZS5vbihcclxuXHRcdFx0XCJ3aW5kb3ctb3BlblwiLCAvLyBcdTVGNTNcdTYyNTNcdTVGMDBcdTdGMTZcdThGOTFcdTU2NjhcdTdBOTdcdTUzRTNcdTY1RjZcdUZGMENcdTg5RTZcdTUzRDFcclxuXHRcdFx0KHdvcmtzcGFjZVdpbmRvdywgd2luZG93KSA9PiB7XHJcblx0XHRcdFx0dGhpcy5yZWdpc3RlckRvY3VtZW50KHdpbmRvdy5kb2N1bWVudCk7XHJcblx0XHRcdH1cclxuXHRcdCk7XHJcblxyXG5cdFx0dGhpcy5yZWdpc3RlckludGVydmFsKFxyXG5cdFx0XHR3aW5kb3cuc2V0SW50ZXJ2YWwoKCkgPT4gY29uc29sZS5sb2coXCJzZXRJbnRlcnZhbFwiKSwgNSAqIDYwICogMTAwMClcclxuXHRcdCk7XHJcblx0fVxyXG5cdG9udW5sb2FkKCkge1xyXG5cdFx0Y29uc29sZS5sb2coXCJEZWxldGUgSW1hZ2UgSW4gVXNlIHBsdWdpbiB1bmxvYWRlZC4uLlwiKTtcclxuXHR9XHJcblxyXG5cdG9uRWxlbWVudChcclxuXHRcdGVsOiBEb2N1bWVudCxcclxuXHRcdGV2ZW50OiBrZXlvZiBIVE1MRWxlbWVudEV2ZW50TWFwLFxyXG5cdFx0c2VsZWN0b3I6IHN0cmluZyxcclxuXHRcdGxpc3RlbmVyOiBMaXN0ZW5lcixcclxuXHRcdG9wdGlvbnM/OiB7IGNhcHR1cmU/OiBib29sZWFuIH1cclxuXHQpIHtcclxuXHRcdGVsLm9uKGV2ZW50LCBzZWxlY3RvciwgbGlzdGVuZXIsIG9wdGlvbnMpO1xyXG5cdFx0cmV0dXJuICgpID0+IGVsLm9mZihldmVudCwgc2VsZWN0b3IsIGxpc3RlbmVyLCBvcHRpb25zKTtcclxuXHR9XHJcblx0cmVnaXN0ZXJEb2N1bWVudChkb2N1bWVudDogRG9jdW1lbnQpIHtcclxuXHRcdHRoaXMucmVnaXN0ZXIoXHJcblx0XHRcdHRoaXMub25FbGVtZW50KFxyXG5cdFx0XHRcdGRvY3VtZW50LFxyXG5cdFx0XHRcdFwiY29udGV4dG1lbnVcIiBhcyBrZXlvZiBIVE1MRWxlbWVudEV2ZW50TWFwLFxyXG5cdFx0XHRcdFwiaW1nXCIsXHJcblx0XHRcdFx0dGhpcy5vbkNsaWNrLmJpbmQodGhpcylcclxuXHRcdFx0KVxyXG5cdFx0KTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcclxuXHRcdHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKFxyXG5cdFx0XHR7fSxcclxuXHRcdFx0REVGQVVMVF9TRVRUSU5HUyxcclxuXHRcdFx0YXdhaXQgdGhpcy5sb2FkRGF0YSgpXHJcblx0XHQpO1xyXG5cdH1cclxuXHRhc3luYyBzYXZlU2V0dGluZ3MoKSB7XHJcblx0XHRhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xyXG5cdH1cclxuXHJcblx0Z2V0QWxsSW1hZ2VGaWxlc0xpc3QgPSAoKTogVEZpbGVbXSA9PiB7XHJcblx0XHRjb25zdCBhbGxGaWxlczogVEZpbGVbXSA9IGFwcC52YXVsdC5nZXRGaWxlcygpO1xyXG5cdFx0Y29uc3QgYXR0YWNobWVudHM6IFRGaWxlW10gPSBbXTtcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgYWxsRmlsZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0aWYgKGFsbEZpbGVzW2ldLmV4dGVuc2lvbiAhPT0gXCJtZFwiKSB7XHJcblx0XHRcdFx0aWYgKGltYWdlRXh0ZW5zaW9ucy5oYXMoYWxsRmlsZXNbaV0uZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpKSB7XHJcblx0XHRcdFx0XHRhdHRhY2htZW50cy5wdXNoKGFsbEZpbGVzW2ldKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiBhdHRhY2htZW50cztcclxuXHR9O1xyXG5cclxuXHRnZXRGaWxlVmlhRnVsbFVSTE9mSW1hZ2UgPSAoaW1hZ2VVUkw6IHN0cmluZyk6IFRGaWxlW10gPT4ge1xyXG5cdFx0bGV0IGltYWdlRmlsZUZ1bGxQYXRoOiBzdHJpbmc7XHJcblx0XHRjb25zdCBmaWxlTGlzdDogVEZpbGVbXSA9IFtdO1xyXG5cdFx0Y29uc3QgYWxsSW1hZ2VGaWxlczogVEZpbGVbXSA9IHRoaXMuZ2V0QWxsSW1hZ2VGaWxlc0xpc3QoKTtcclxuXHRcdGFsbEltYWdlRmlsZXMuZm9yRWFjaCgoaW1hZ2VGaWxlKSA9PiB7XHJcblx0XHRcdGltYWdlRmlsZUZ1bGxQYXRoID0gYXBwLnZhdWx0LmdldFJlc291cmNlUGF0aChpbWFnZUZpbGUpO1xyXG5cdFx0XHRpZiAoaW1hZ2VVUkwgPT09IGltYWdlRmlsZUZ1bGxQYXRoKSB7XHJcblx0XHRcdFx0ZmlsZUxpc3QucHVzaChpbWFnZUZpbGUpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHRcdHJldHVybiBmaWxlTGlzdDtcclxuXHR9O1xyXG5cdHJlZ2lzdGVyRXNjYXBlQnV0dG9uKG1lbnU6IE1lbnUsIGRvY3VtZW50OiBEb2N1bWVudCA9IGFjdGl2ZURvY3VtZW50KSB7XHJcblx0XHRtZW51LnJlZ2lzdGVyKFxyXG5cdFx0XHR0aGlzLm9uRWxlbWVudChcclxuXHRcdFx0XHRkb2N1bWVudCxcclxuXHRcdFx0XHRcImtleWRvd25cIiBhcyBrZXlvZiBIVE1MRWxlbWVudEV2ZW50TWFwLFxyXG5cdFx0XHRcdFwiKlwiLFxyXG5cdFx0XHRcdChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcblx0XHRcdFx0XHRpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cdFx0XHRcdFx0XHRtZW51LmhpZGUoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdClcclxuXHRcdCk7XHJcblx0fVxyXG5cclxuXHRvbkNsaWNrKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcblx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0Y29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEVsZW1lbnQ7XHJcblx0XHRjb25zdCBpbWdUeXBlID0gdGFyZ2V0LmxvY2FsTmFtZTtcclxuXHRcdGNvbnN0IG1lbnUgPSBuZXcgTWVudSgpO1xyXG5cdFx0Y29uc3QgZGVsZXRlT3B0aW9uID0gdGhpcy5zZXR0aW5ncy5kZWxldGVPcHRpb247XHJcblx0XHRsZXQgZmlsZUxpc3Q6IFRGaWxlW107XHJcblx0XHRzd2l0Y2ggKGltZ1R5cGUpIHtcclxuXHRcdFx0Y2FzZSBcImltZ1wiOiB7XHJcblx0XHRcdFx0Y29uc3QgaW1hZ2UgPSAodGFyZ2V0IGFzIEhUTUxJbWFnZUVsZW1lbnQpLmN1cnJlbnRTcmM7XHJcblx0XHRcdFx0Y29uc3QgaW1hZ2VEb20gPSB0YXJnZXQgYXMgSFRNTEltYWdlRWxlbWVudDtcclxuXHRcdFx0XHRjb25zdCB0aGlzVVJMID0gbmV3IFVSTChpbWFnZSk7XHJcblx0XHRcdFx0ZmlsZUxpc3QgPSB0aGlzLmdldEZpbGVWaWFGdWxsVVJMT2ZJbWFnZShpbWFnZSk7XHJcblx0XHRcdFx0Y29uc3QgUHJvdG8gPSB0aGlzVVJMLnByb3RvY29sO1xyXG5cdFx0XHRcdHN3aXRjaCAoUHJvdG8pIHtcclxuXHRcdFx0XHRcdGNhc2UgXCJhcHA6XCI6XHJcblx0XHRcdFx0XHRjYXNlIFwiZGF0YTpcIjpcclxuXHRcdFx0XHRcdGNhc2UgXCJodHRwOlwiOlxyXG5cdFx0XHRcdFx0Y2FzZSBcImh0dHBzOlwiOlxyXG5cdFx0XHRcdFx0XHRtZW51LmFkZEl0ZW0oKGl0ZW06IE1lbnVJdGVtKSA9PlxyXG5cdFx0XHRcdFx0XHRcdGl0ZW1cclxuXHRcdFx0XHRcdFx0XHRcdC5zZXRJY29uKFwidHJhc2hcIilcclxuXHRcdFx0XHRcdFx0XHRcdC5zZXRUaXRsZShcIkRlbGV0ZSBJbWFnZSBJbiBVc2UgdXJsIGFuZCBmaWxlXCIpXHJcblx0XHRcdFx0XHRcdFx0XHQub25DbGljayhhc3luYyAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Zm9yIChjb25zdCBmaWxlIG9mIGZpbGVMaXN0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjb25zdCBwYXJlbnRfZGl2OiBIVE1MRGl2RWxlbWVudCA9XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGltYWdlRG9tLnBhcmVudEVsZW1lbnRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQ/LnBhcmVudEVsZW1lbnQgYXMgSFRNTERpdkVsZW1lbnQ7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjb25zdCBwYXJlbnRPZmltZ2U6IEhUTUxEaXZFbGVtZW50ID1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aW1hZ2VEb20ucGFyZW50RWxlbWVudCBhcyBIVE1MRGl2RWxlbWVudDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHBhcmVudF9kaXYucmVtb3ZlQ2hpbGQoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHBhcmVudE9maW1nZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcIlx1RDgzRFx1REVBOS0tLS0tLS0tcGFyZW50X2RpYyBhdHRyaWJ1dGVuYW1lLS0tLS0tLS06XCIgK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHBhcmVudF9kaXYuZ2V0QXR0cmlidXRlTmFtZXNcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZGVsZXRlT3B0aW9uID09PSBcIi50cmFzaFwiKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGF3YWl0IGFwcC52YXVsdC50cmFzaChcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmaWxlLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFwiLS1cdTU2RkVcdTcyNDctLVwiICtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRoaXNVUkwgK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XCJcdTg4QUJcdTUyMjBcdTk2NjRcdTRFODZcIlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRuZXcgTm90aWNlKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFwiSW1hZ2UgbW92ZWQgdG8gT2JzaWRpYW4gVHJhc2ggIVwiLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFNVQ0NFU1NfTk9USUNFX1RJTUVPVVRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRlbGV0ZU9wdGlvbiA9PT0gXCJzeXN0ZW0tdHJhc2hcIlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGF3YWl0IGFwcC52YXVsdC50cmFzaChcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmaWxlLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRydWVcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XCItLVx1NTZGRVx1NzI0Ny0tXCIgK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpc1VSTCArXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcIlx1ODhBQlx1NTIyMFx1OTY2NFx1NEU4NlwiXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdG5ldyBOb3RpY2UoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XCJJbWFnZSBtb3ZlZCB0byBTeXN0ZW0gVHJhc2ggIVwiLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFNVQ0NFU1NfTk9USUNFX1RJTUVPVVRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRlbGV0ZU9wdGlvbiA9PT0gXCJwZXJtYW5lbnRcIlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGF3YWl0IGFwcC52YXVsdC5kZWxldGUoZmlsZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFwiLS1cdTU2RkVcdTcyNDctLVwiICtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRoaXNVUkwgK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XCJcdTg4QUJcdTUyMjBcdTk2NjRcdTRFODZcIlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRuZXcgTm90aWNlKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFwiSW1hZ2UgZGVsZXRlZCBQZXJtYW5lbnRseSAhXCIsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0U1VDQ0VTU19OT1RJQ0VfVElNRU9VVFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0fSBjYXRjaCB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0bmV3IE5vdGljZShcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFwiRXJyb3IsIGNvdWxkIG5vdCBkZWxleWUgdGhlIGltYWdlIVwiXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0fSlcclxuXHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRkZWZhdWx0OlxyXG5cdFx0XHRcdFx0XHRuZXcgTm90aWNlKGBubyBoYW5kbGVyIGZvciAke1Byb3RvfSBwcm90b2NvbGApO1xyXG5cdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0bmV3IE5vdGljZShcIk5vIGhhbmRsZXIgZm9yIHRoaXMgaW1hZ2UgdHlwZSFcIik7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5yZWdpc3RlckVzY2FwZUJ1dHRvbihtZW51KTtcclxuXHRcdG1lbnUuc2hvd0F0UG9zaXRpb24oeyB4OiBldmVudC5wYWdlWCwgeTogZXZlbnQucGFnZVkgfSk7XHJcblx0XHR0aGlzLmFwcC53b3Jrc3BhY2UudHJpZ2dlcihcIm5uLWRlbGV0ZS1pbWFnZS1pbi11c2U6Y29udGV4dG1lbnVcIiwgbWVudSk7XHJcblx0fVxyXG59XHJcbiIsICJpbXBvcnQgTmF0aGFuRGVsZXRlSW1hZ2UgZnJvbSBcIi4vbWFpblwiO1xyXG5pbXBvcnQgeyBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgTmF0aGFuRGVsZXRlSW1hZ2VTZXR0aW5ncyB7XHJcblx0ZGVsZXRlT3B0aW9uOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBOYXRoYW5EZWxldGVJbWFnZVNldHRpbmdzID0ge1xyXG5cdGRlbGV0ZU9wdGlvbjogXCIudHJhc2hcIixcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBOYXRoYW5EZWxldGVJbWFnZVNldHRpbmdzVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XHJcblx0cGx1Z2luOiBOYXRoYW5EZWxldGVJbWFnZTtcclxuXHJcblx0Y29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTmF0aGFuRGVsZXRlSW1hZ2UpIHtcclxuXHRcdHN1cGVyKGFwcCwgcGx1Z2luKTtcclxuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG5cdH1cclxuXHJcblx0ZGlzcGxheSgpOiB2b2lkIHtcclxuXHRcdGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XHJcblx0XHRjb250YWluZXJFbC5lbXB0eSgpO1xyXG5cdFx0Y29udGFpbmVyRWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiRGVsZXRlIEltYWdlIEluIFVzZSBTZXR0aW5nc1wiIH0pO1xyXG5cclxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG5cdFx0XHQuc2V0TmFtZShcIkRlbGV0ZWQgSW1hZ2UgRGVzdGluYXRpb25cIilcclxuXHRcdFx0LnNldERlc2MoXHJcblx0XHRcdFx0XCJTZWxlY3Qgd2hlcmUgeW91IHdhbnQgaW1hZ2VzIHRvIGJlIG1vdmVkIG9uY2UgdGhleSBhcmUgZGVsZXRlZFwiXHJcblx0XHRcdClcclxuXHRcdFx0LmFkZERyb3Bkb3duKChkcm9wZG93bikgPT4ge1xyXG5cdFx0XHRcdGRyb3Bkb3duLmFkZE9wdGlvbihcInBlcm1hbmVudFwiLCBcIkRlbGV0ZSBQZXJtYW5lbnRseVwiKTtcclxuXHRcdFx0XHRkcm9wZG93bi5hZGRPcHRpb24oXCIudHJhc2hcIiwgXCJNb3ZlIHRvIE9ic2lkaWFuIFRyYXNoXCIpO1xyXG5cdFx0XHRcdGRyb3Bkb3duLmFkZE9wdGlvbihcInN5c3RlbS10cmFzaFwiLCBcIk1vdmUgdG8gU3lzdGVtIFRyYXNoXCIpO1xyXG5cdFx0XHRcdGRyb3Bkb3duLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlbGV0ZU9wdGlvbik7XHJcblx0XHRcdFx0ZHJvcGRvd24ub25DaGFuZ2UoKG9wdGlvbikgPT4ge1xyXG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVsZXRlT3B0aW9uID0gb3B0aW9uO1xyXG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdH1cclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQXNEOzs7QUNDdEQsc0JBQStDO0FBTXhDLElBQU0sbUJBQThDO0FBQUEsRUFDMUQsY0FBYztBQUNmO0FBRU8sSUFBTSwrQkFBTixjQUEyQyxpQ0FBaUI7QUFBQSxFQUdsRSxZQUFZLE1BQVUsUUFBMkI7QUFDaEQsVUFBTSxNQUFLLE1BQU07QUFDakIsU0FBSyxTQUFTO0FBQUEsRUFDZjtBQUFBLEVBRUEsVUFBZ0I7QUFDZixVQUFNLEVBQUUsZ0JBQWdCO0FBQ3hCLGdCQUFZLE1BQU07QUFDbEIsZ0JBQVksU0FBUyxNQUFNLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUVuRSxRQUFJLHdCQUFRLFdBQVcsRUFDckIsUUFBUSwyQkFBMkIsRUFDbkMsUUFDQSxnRUFDRCxFQUNDLFlBQVksQ0FBQyxhQUFhO0FBQzFCLGVBQVMsVUFBVSxhQUFhLG9CQUFvQjtBQUNwRCxlQUFTLFVBQVUsVUFBVSx3QkFBd0I7QUFDckQsZUFBUyxVQUFVLGdCQUFnQixzQkFBc0I7QUFDekQsZUFBUyxTQUFTLEtBQUssT0FBTyxTQUFTLFlBQVk7QUFDbkQsZUFBUyxTQUFTLENBQUMsV0FBVztBQUM3QixhQUFLLE9BQU8sU0FBUyxlQUFlO0FBQ3BDLGFBQUssT0FBTyxhQUFhO0FBQUEsTUFDMUIsQ0FBQztBQUFBLElBQ0YsQ0FBQztBQUFBLEVBQ0g7QUFD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QU87QUFDWCxjQUFNLFFBQVMsT0FBNEI7QUFDM0MsY0FBTSxXQUFXO0FBQ2pCLGNBQU0sVUFBVSxJQUFJLElBQUksS0FBSztBQUM3QixtQkFBVyxLQUFLLHlCQUF5QixLQUFLO0FBQzlDLGNBQU0sUUFBUSxRQUFRO0FBQ3RCLGdCQUFRO0FBQUEsZUFDRjtBQUFBLGVBQ0E7QUFBQSxlQUNBO0FBQUEsZUFDQTtBQUNKLGlCQUFLLFFBQVEsQ0FBQyxTQUNiLEtBQ0UsUUFBUSxPQUFPLEVBQ2YsU0FBUyxrQ0FBa0MsRUFDM0MsUUFBUSxZQUFZO0FBekk3QjtBQTBJUyxrQkFBSTtBQUNILDJCQUFXLFFBQVEsVUFBVTtBQUM1Qix3QkFBTSxhQUNMLGVBQVMsa0JBQVQsbUJBQ0c7QUFDSix3QkFBTSxlQUNMLFNBQVM7QUFDViw2QkFBVyxZQUNWLFlBQ0Q7QUFDQSwwQkFBUSxJQUNQLHVEQUNDLFdBQVcsaUJBQ2I7QUFDQSxzQkFBSSxpQkFBaUIsVUFBVTtBQUM5QiwwQkFBTSxJQUFJLE1BQU0sTUFDZixNQUNBLEtBQ0Q7QUFDQSw0QkFBUSxJQUNQLHFCQUNDLFVBQ0EsMEJBQ0Y7QUFDQSx3QkFBSSx3QkFDSCxtQ0FDQSxzQkFDRDtBQUFBLGtCQUNELFdBQ0MsaUJBQWlCLGdCQUNoQjtBQUNELDBCQUFNLElBQUksTUFBTSxNQUNmLE1BQ0EsSUFDRDtBQUNBLDRCQUFRLElBQ1AscUJBQ0MsVUFDQSwwQkFDRjtBQUNBLHdCQUFJLHdCQUNILGlDQUNBLHNCQUNEO0FBQUEsa0JBQ0QsV0FDQyxpQkFBaUIsYUFDaEI7QUFDRCwwQkFBTSxJQUFJLE1BQU0sT0FBTyxJQUFJO0FBQzNCLDRCQUFRLElBQ1AscUJBQ0MsVUFDQSwwQkFDRjtBQUNBLHdCQUFJLHdCQUNILCtCQUNBLHNCQUNEO0FBQUEsa0JBQ0Q7QUFBQSxnQkFDRDtBQUFBLGNBQ0QsU0FBUSxHQUFOO0FBQ0Qsb0JBQUksd0JBQ0gsb0NBQ0Q7QUFBQSxjQUNEO0FBQUEsWUFDRCxDQUFDLENBQ0g7QUFDQTtBQUFBO0FBRUEsZ0JBQUksd0JBQU8sa0JBQWtCLGdCQUFnQjtBQUM3QztBQUFBO0FBRUY7QUFBQSxNQUNEO0FBQUE7QUFFQyxZQUFJLHdCQUFPLGlDQUFpQztBQUM1QztBQUFBO0FBRUYsU0FBSyxxQkFBcUIsSUFBSTtBQUM5QixTQUFLLGVBQWUsRUFBRSxHQUFHLE1BQU0sT0FBTyxHQUFHLE1BQU0sTUFBTSxDQUFDO0FBQ3RELFNBQUssSUFBSSxVQUFVLFFBQVEsc0NBQXNDLElBQUk7QUFBQSxFQUN0RTtBQUNEOyIsCiAgIm5hbWVzIjogW10KfQo=
